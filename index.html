<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosas | Aleix</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #6366f1; --bg: #030712; --surf: #111827; --text: #f9fafb; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: auto; }
        
        /* Notificaci√≥n de Error */
        #debug-log { background: #450a0a; color: #f87171; padding: 10px; border-radius: 8px; margin-bottom: 20px; display: none; font-size: 12px; border: 1px solid #7f1d1d; }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .stats { background: var(--surf); padding: 10px 20px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.1); }

        /* Formulario */
        .admin-card { background: var(--surf); padding: 20px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 30px; }
        .grid-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        input { background: #1f2937; border: 1px solid #374151; color: white; padding: 12px; border-radius: 10px; outline: none; }
        
        .btn { background: var(--accent); color: white; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: bold; width: 100%; }
        .btn:hover { opacity: 0.8; }

        /* Grid Productos */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .card { background: var(--surf); border-radius: 20px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); position: relative; }
        .card img { width: 100%; height: 180px; object-fit: cover; }
        .card-info { padding: 15px; }
        .card-name { font-weight: bold; font-size: 1.1rem; display: block; }
        .card-price { font-size: 1.4rem; color: var(--accent); font-weight: 800; margin: 5px 0; }
        
        .actions { position: absolute; top: 10px; right: 10px; display: flex; gap: 5px; }
        .mini-btn { width: 30px; height: 30px; border-radius: 8px; border: none; cursor: pointer; color: white; }
    </style>
</head>
<body>

<div class="container">
    <div id="debug-log"></div>

    <div class="header">
        <h1>Cosas</h1>
        <div class="stats">Total: <span id="totalPrice">0.00 ‚Ç¨</span></div>
    </div>

    <div class="admin-card">
        <div class="grid-inputs">
            <input id="name" placeholder="Nombre">
            <input id="price" type="number" step="0.01" placeholder="Precio ‚Ç¨">
            <input id="link" placeholder="Enlace Web">
            <input id="image" placeholder="URL Imagen">
        </div>
        <div style="display: flex; gap: 10px;">
            <input id="pass" type="password" placeholder="Pass (1234)" style="width: 120px;">
            <button class="btn" onclick="guardar()">Guardar Producto</button>
        </div>
        <input type="hidden" id="editId">
    </div>

    <div id="productContainer" class="grid">
        <p id="loading-text">Cargando productos desde Firebase...</p>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
    // 1. Configuraci√≥n (Aseg√∫rate de que estos datos son los tuyos)
    const firebaseConfig = {
        apiKey: "AIzaSyBTobN1gD7fhXYiwH1w7dYQLWi3bFZoBjU",
        authDomain: "cosas-af46c.firebaseapp.com",
        projectId: "cosas-af46c",
        storageBucket: "cosas-af46c.firebasestorage.app",
        messagingSenderId: "145996030094",
        appId: "1:145996030094:web:2f8f38fdbde5d6d386e9df"
    };

    // 2. Inicializar
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const PASS = "1234";

    // Funci√≥n para mostrar errores en pantalla
    function logError(err) {
        const div = document.getElementById('debug-log');
        div.style.display = 'block';
        div.innerHTML = "<b>ERROR:</b> " + err;
        console.error(err);
    }

    // 3. Escuchar Datos (Nombre de colecci√≥n: productos)
    db.collection("productos").onSnapshot((snapshot) => {
        const container = document.getElementById("productContainer");
        let html = "";
        let total = 0;

        if (snapshot.empty) {
            container.innerHTML = "<p>No hay productos en la base de datos.</p>";
            document.getElementById("totalPrice").innerText = "0.00 ‚Ç¨";
            return;
        }

        snapshot.forEach((doc) => {
            const p = doc.data();
            const id = doc.id;
            total += parseFloat(p.price || 0);
            
            html += `
                <div class="card">
                    <div class="actions">
                        <button class="mini-btn" style="background:#f1c40f" onclick="editar('${id}')">‚úèÔ∏è</button>
                        <button class="mini-btn" style="background:#e74c3c" onclick="eliminar('${id}')">√ó</button>
                    </div>
                    <img src="${p.image}" onerror="this.src='https://via.placeholder.com/300x200?text=Error+Imagen'">
                    <div class="card-info">
                        <span class="card-name">${p.name || 'Sin nombre'}</span>
                        <div class="card-price">${parseFloat(p.price).toFixed(2)}‚Ç¨</div>
                        <a href="${p.link}" target="_blank" style="color:var(--accent); text-decoration:none; font-size:12px;">üîó Ver enlace</a>
                    </div>
                </div>`;
        });

        container.innerHTML = html;
        document.getElementById("totalPrice").innerText = total.toFixed(2) + " ‚Ç¨";
    }, (error) => {
        logError("Firebase dice: " + error.message);
    });

    // 4. Guardar / Editar
    async function guardar() {
        if (document.getElementById("pass").value !== PASS) return alert("Contrase√±a incorrecta");
        
        const id = document.getElementById("editId").value;
        const datos = {
            name: document.getElementById("name").value,
            price: parseFloat(document.getElementById("price").value) || 0,
            link: document.getElementById("link").value,
            image: document.getElementById("image").value,
            fecha: new Date()
        };

        try {
            if (id) {
                await db.collection("productos").doc(id).update(datos);
            } else {
                await db.collection("productos").add(datos);
            }
            limpiar();
        } catch (e) {
            logError("Error al guardar: " + e.message);
        }
    }

    function eliminar(id) {
        if (prompt("Contrase√±a:") === PASS) {
            db.collection("productos").doc(id).delete().catch(e => logError(e.message));
        }
    }

    function editar(id) {
        // Buscamos los datos en la pantalla para no llamar a Firebase otra vez
        db.collection("productos").doc(id).get().then(doc => {
            const p = doc.data();
            document.getElementById("name").value = p.name;
            document.getElementById("price").value = p.price;
            document.getElementById("link").value = p.link;
            document.getElementById("image").value = p.image;
            document.getElementById("editId").value = id;
            window.scrollTo(0,0);
        });
    }

    function limpiar() {
        ["name", "price", "link", "image", "pass", "editId"].forEach(i => document.getElementById(i).value = "");
    }
</script>
</body>
</html>
