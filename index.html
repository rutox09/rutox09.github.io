<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cosas Aleix - Admin</title>
<style>
  :root { --primary: #28a745; --danger: #dc3545; --dark: #333; }
  body { font-family: 'Segoe UI', sans-serif; background:#f4f7f6; margin: 0; padding: 20px; }
  .container { max-width: 800px; margin: auto; background:white; padding:30px; border-radius:15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
  h2 { text-align: center; }
  table { width:100%; border-collapse:collapse; margin-top:20px; }
  th, td { padding: 12px; border-bottom: 1px solid #eee; text-align:center; }
  img { width:60px; height:60px; object-fit: cover; border-radius:8px; }
  .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
  .btn-add { background: var(--primary); color: white; width: 100%; margin-top: 10px; }
  .btn-delete { background: var(--danger); color: white; padding: 5px 10px; }
  #adminPanel { background: #f9f9f9; padding: 20px; border-radius: 10px; margin-bottom: 30px; border: 1px dashed #ccc; display: none; }
  #loginOverlay { 
    display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
    background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; 
  }
  .login-box { background: white; padding: 30px; border-radius: 10px; width: 280px; text-align: center; }
  input { width: 100%; padding: 10px; margin: 5px 0; box-sizing: border-box; }
</style>
</head>
<body>

<div class="container">
  <h2>üõçÔ∏è Lista de Deseos</h2>

  <div id="adminPanel">
    <h3>A√±adir Producto</h3>
    <input id="price" type="number" placeholder="Precio ‚Ç¨">
    <input id="link" placeholder="Enlace web">
    <input id="image" placeholder="Enlace imagen">
    <button id="addBtn" class="btn btn-add">Guardar</button>
    <button onclick="logout()" style="margin-top:10px; background:none; border:none; color:gray; cursor:pointer;">Cerrar Sesi√≥n</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>Imagen</th>
        <th>Precio</th>
        <th>Link</th>
        <th class="admin-only" style="display:none">Acci√≥n</th>
      </tr>
    </thead>
    <tbody id="products"></tbody>
  </table>

  <div id="totalPrice" style="text-align:center; font-weight:bold; font-size:1.5em; margin-top:20px;">Total: 0.00 ‚Ç¨</div>
  
  <button onclick="document.getElementById('loginOverlay').style.display='flex'" style="display:block; margin: 40px auto; color:#ccc; background:none; border:none; cursor:pointer;">Admin Login</button>
</div>

<div id="loginOverlay">
  <div class="login-box">
    <h3>Entrar</h3>
    <input id="email" type="email" placeholder="Correo">
    <input id="pass" type="password" placeholder="Contrase√±a">
    <button onclick="login()" class="btn btn-add">Entrar</button>
    <button onclick="document.getElementById('loginOverlay').style.display='none'" style="margin-top:10px; border:none; background:none; cursor:pointer;">Cancelar</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBTobN1gD7fhXYiwH1w7dYQLWi3bFZoBjU",
    authDomain: "cosas-af46c.firebaseapp.com",
    projectId: "cosas-af46c",
    storageBucket: "cosas-af46c.firebasestorage.app",
    messagingSenderId: "145996030094",
    appId: "1:145996030094:web:2f8f38fdbde5d6d386e9df"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();

  // LOGIN
  function login() {
    const email = document.getElementById("email").value;
    const pass = document.getElementById("pass").value;
    auth.signInWithEmailAndPassword(email, pass)
      .then(() => document.getElementById('loginOverlay').style.display='none')
      .catch(err => alert("Datos incorrectos"));
  }

  function logout() { auth.signOut(); }

  // ESTADO DE LA SESI√ìN
  auth.onAuthStateChanged(user => {
    const isLogged = !!user;
    document.getElementById('adminPanel').style.display = isLogged ? 'block' : 'none';
    cargarProductos(isLogged);
  });

  // A√ëADIR
  document.getElementById("addBtn").onclick = () => {
    const price = Number(document.getElementById("price").value);
    const link = document.getElementById("link").value;
    const image = document.getElementById("image").value;
    if(price && link && image) {
      db.collection("productos").add({ price, link, image, date: new Date() });
    }
  };

  // BORRAR
  window.borrar = (id) => { if(confirm("¬øBorrar?")) db.collection("productos").doc(id).delete(); };

  // MOSTRAR PRODUCTOS
  function cargarProductos(admin) {
    db.collection("productos").orderBy("date", "desc").onSnapshot(snap => {
      let html = ""; let total = 0;
      snap.forEach(doc => {
        const p = doc.data();
        total += p.price;
        html += `<tr>
          <td><img src="${p.image}"></td>
          <td>${p.price.toFixed(2)} ‚Ç¨</td>
          <td><a href="${p.link}" target="_blank">Ver</a></td>
          <td style="display:${admin ? 'table-cell' : 'none'}">
            <button class="btn btn-delete" onclick="borrar('${doc.id}')">üóëÔ∏è</button>
          </td>
        </tr>`;
      });
      document.getElementById("products").innerHTML = html;
      document.getElementById("totalPrice").innerText = `Total: ${total.toFixed(2)} ‚Ç¨`;
    });
  }
</script>
</body>
</html>
