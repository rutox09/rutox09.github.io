<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cosas Aleix</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f0f0f0;
  margin: 0;
  padding: 0;
}

.container {
  max-width: 1000px;
  margin: 20px auto;
  background: white;
  padding: 20px;
  border-radius: 15px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

h1 {
  text-align: center;
}

#total {
  text-align: center;
  font-size: 20px;
  font-weight: bold;
  margin-bottom: 15px;
  color: #007bff;
}

.controls {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: space-between;
  margin-bottom: 15px;
}

.controls button, .controls select {
  padding: 10px 12px;
  border-radius: 8px;
  border: none;
  background: #007bff;
  color: white;
  cursor: pointer;
  font-size: 14px;
}

.controls select {
  background: #6c757d;
}

.form {
  display: grid;
  grid-template-columns: 1.5fr 1fr 1.5fr 2fr 2fr auto;
  gap: 10px;
  margin-bottom: 20px;
}

input, select, button.add {
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 14px;
}

button.add {
  background: #28a745;
  color: white;
  border: none;
}

table {
  width: 100%;
  border-collapse: collapse;
  overflow-x: auto;
}

th {
  background: #007bff;
  color: white;
  padding: 12px;
  font-size: 14px;
}

td {
  padding: 10px;
  border-bottom: 1px solid #ddd;
  text-align: center;
  font-size: 14px;
}

tr.fade-out {
  opacity: 0;
  transform: translateX(50px);
  transition: 0.3s;
}

.product-name {
  font-weight: bold;
  margin-bottom: 5px;
  font-size: 13px;
}

img {
  width: 70px;
  border-radius: 6px;
}

.action-btn {
  margin: 2px;
  padding: 5px 8px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-size: 12px;
}

.edit { background: #ffc107; }
.delete { background: #dc3545; color: white; }

/* Responsive */
@media (max-width: 800px) {
  .form {
    grid-template-columns: 1fr 1fr 1fr;
    grid-auto-rows: minmax(40px, auto);
  }
  .form button.add { grid-column: span 3; }
  th, td { font-size: 12px; padding: 8px; }
  img { width: 50px; }
  .action-btn { padding: 4px 6px; font-size: 11px; }
}

@media (max-width: 500px) {
  .controls { flex-direction: column; }
  .controls button, .controls select { width: 100%; }
}
</style>
</head>

<body>
<div class="container">
  <h1>Cosas</h1>
  <div id="total">Total: 0 €</div>

  <div class="controls">
    <div>
      <button onclick="sortPriceAsc()">Precio ↓</button>
      <button onclick="sortPriceDesc()">Precio ↑</button>
      <button onclick="exportCSV()">Exportar Excel</button>
    </div>
    <select id="filterCategory" onchange="render()">
      <option value="Todas">Todas las categorías</option>
      <option value="General">General</option>
      <option value="Ropa">Ropa</option>
      <option value="Tecnología">Tecnología</option>
      <option value="Otros">Otros</option>
    </select>
  </div>

  <div class="form">
    <input id="name" placeholder="Nombre (opcional)">
    <input id="price" type="number" placeholder="Precio €">
    <select id="category">
      <option value="General">General</option>
      <option value="Ropa">Ropa</option>
      <option value="Tecnología">Tecnología</option>
      <option value="Otros">Otros</option>
    </select>
    <input id="link" placeholder="Link del producto">
    <input id="image" placeholder="URL imagen">
    <button class="add" onclick="addProduct()">Añadir</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>Producto</th>
        <th>Precio</th>
        <th>Categoría</th>
        <th>Link</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody id="products"></tbody>
  </table>
</div>

<script>
let products = JSON.parse(localStorage.getItem("products")) || [];
render();

function addProduct() {
  const product = {
    id: Date.now(),
    name: name.value,
    price: Number(price.value),
    category: category.value,
    link: link.value.trim(),
    image: image.value.trim()
  };

  if (!product.price || !product.link || !product.image) {
    alert("Faltan datos obligatorios");
    return;
  }

  if (products.some(p => p.link === product.link)) {
    alert("Ese enlace web ya esta añadido");
    return;
  }

  if (products.some(p => p.image === product.image)) {
    alert("Esa imagen ya esta añadida");
    return;
  }

  products.push(product);
  save();
  render();
  clearForm();
}

function render() {
  const tbody = document.getElementById("products");
  const filter = document.getElementById("filterCategory").value;
  tbody.innerHTML = "";

  let total = 0;

  products
    .filter(p => filter === "Todas" || p.category === filter)
    .forEach(p => {
      total += p.price;
      tbody.innerHTML += `
        <tr id="${p.id}">
          <td>${p.name ? `<div class="product-name">${p.name}</div>` : ""}<img src="${p.image}"></td>
          <td>${p.price.toFixed(2)} €</td>
          <td>${p.category}</td>
          <td><a href="${p.link}" target="_blank">Ver</a></td>
          <td>
            <button class="action-btn edit" onclick="editProduct(${p.id})">Editar</button>
            <button class="action-btn delete" onclick="deleteProduct(${p.id})">Borrar</button>
          </td>
        </tr>
      `;
    });

  document.getElementById("total").innerText = "Total: " + total.toFixed(2) + " €";
}

function deleteProduct(id) {
  const row = document.getElementById(id);
  row.classList.add("fade-out");
  setTimeout(() => {
    products = products.filter(p => p.id !== id);
    save();
    render();
  }, 300);
}

function editProduct(id) {
  const p = products.find(p => p.id === id);
  name.value = p.name;
  price.value = p.price;
  category.value = p.category;
  link.value = p.link;
  image.value = p.image;
  deleteProduct(id);
}

function sortPriceAsc() {
  products.sort((a,b)=>a.price-b.price);
  save();
  render();
}

function sortPriceDesc() {
  products.sort((a,b)=>b.price-a.price);
  save();
  render();
}

function exportCSV() {
  let csv = "Nombre,Precio,Categoría,Link,Imagen\n";
  products.forEach(p => {
    csv += `"${p.name}",${p.price},"${p.category}","${p.link}","${p.image}"\n`;
  });
  const blob = new Blob([csv], {type: "text/csv"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "compras.csv";
  a.click();
}

function save() {
  localStorage.setItem("products", JSON.stringify(products));
}

function clearForm() {
  name.value = "";
  price.value = "";
  link.value = "";
  image.value = "";
}
</script>
</body>
</html>
