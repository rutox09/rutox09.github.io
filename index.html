<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cosas Aleix</title>
<style>
body { font-family: Arial; background:#f0f0f0; }
.container { max-width: 600px; margin:20px auto; background:white; padding:20px; border-radius:10px; }
input, button { width:100%; padding:10px; margin:5px 0; }
button { background:#28a745; color:white; border:none; cursor:pointer; }
table { width:100%; border-collapse:collapse; margin-top:20px; }
th, td { border:1px solid #ccc; padding:5px; text-align:center; }
img { width:50px; border-radius:4px; }
.deleteBtn { background:#dc3545; color:white; padding:5px 8px; border:none; border-radius:4px; cursor:pointer; }
#totalPrice { font-weight:bold; margin-top:10px; text-align:center; }
</style>
</head>
<body>

<div class="container">
  <h2>Cosas Aleix</h2>
  <input id="price" type="number" placeholder="Precio €">
  <input id="link" placeholder="URL del producto">
  <input id="image" placeholder="URL de la imagen">
  <button id="addBtn">Añadir Producto</button>

  <table>
    <thead>
      <tr>
        <th>Imagen</th>
        <th>Precio</th>
        <th>Link</th>
        <th>Eliminar</th>
      </tr>
    </thead>
    <tbody id="products"></tbody>
  </table>

  <div id="totalPrice">Total: 0 €</div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<script>
  // Configura Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBTobN1gD7fhXYiwH1w7dYQLWi3bFZoBjU",
    authDomain: "cosas-af46c.firebaseapp.com",
    projectId: "cosas-af46c",
    storageBucket: "cosas-af46c.firebasestorage.app",
    messagingSenderId: "145996030094",
    appId: "1:145996030094:web:2f8f38fdbde5d6d386e9df"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const productosCol = db.collection("productos");

  const priceInput = document.getElementById("price");
  const linkInput = document.getElementById("link");
  const imageInput = document.getElementById("image");
  const addBtn = document.getElementById("addBtn");
  const tbody = document.getElementById("products");
  const totalDiv = document.getElementById("totalPrice");

  // Añadir producto
  addBtn.onclick = function() {
    const price = Number(priceInput.value);
    const link = linkInput.value.trim();
    const image = imageInput.value.trim();

    if (!price || !link || !image) { alert("Rellena todos los campos"); return; }

    productosCol.add({ price, link, image })
      .then(() => {
        priceInput.value = "";
        linkInput.value = "";
        imageInput.value = "";
      })
      .catch(err => alert("Error al añadir: " + err));
  };

  // Eliminar producto
  function deleteProduct(id) {
    productosCol.doc(id).delete();
  }

  // Mostrar productos en tiempo real y calcular total
  productosCol.onSnapshot(snapshot => {
    tbody.innerHTML = "";
    let total = 0;
    snapshot.forEach(doc => {
      const p = doc.data();
      const price = p.price ? Number(p.price).toFixed(2) : "0.00";
      total += Number(price);
      const link = p.link ? p.link : "#";
      const image = p.image ? p.image : "";

      tbody.innerHTML += `
        <tr>
          <td>${image ? `<img src="${image}" alt="Imagen">` : ""}</td>
          <td>${price} €</td>
          <td><a href="${link}" target="_blank">Ver</a></td>
          <td><button class="deleteBtn" onclick="deleteProduct('${doc.id}')">Eliminar</button></td>
        </tr>
      `;
    });
    totalDiv.innerText = "Total: " + total.toFixed(2) + " €";
  });
</script>

</body>
</html>
